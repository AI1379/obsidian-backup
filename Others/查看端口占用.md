---
tags:
  - Linux
  - 运维
---
> 内容来自 `Gemini-2.5-flash`

在 Linux 中，有多种方法可以查看哪些端口被占用。最常用和推荐的命令是 `ss` 和 `netstat`，`lsof` 也是一个非常强大的工具。

以下是详细的介绍和使用方法：

### 1. 使用 `ss` 命令 (推荐，更现代、高效)

`ss` (socket statistics) 命令是 `netstat` 的替代品，它能更快地提供更多的 TCP/IP 套接字信息。

**常用选项：**

*   `-t`: 显示 TCP 连接
*   `-u`: 显示 UDP 连接
*   `-l`: 仅显示正在监听的套接字（Listen）
*   `-n`: 不解析服务名，直接显示端口号（numeric）
*   `-p`: 显示占用套接字的进程名和 PID
*   `-a`: 显示所有套接字（包括监听和非监听的）
*   `-e`: 显示详细的套接字信息

**查看所有正在监听的 TCP 和 UDP 端口及其进程信息：**

```bash
sudo ss -tulnp
```

**输出示例解释：**

```
Netid  State      Recv-Q Send-Q Local Address:Port               Peer Address:Port
udp    UNCONN     0      0      0.0.0.0:68                      0.0.0.0:*      users:(("dhclient",pid=762,fd=6))
tcp    LISTEN     0      128    0.0.0.0:22                      0.0.0.0:*      users:(("sshd",pid=908,fd=3))
tcp    LISTEN     0      128    127.0.0.1:631                     0.0.0.0:*      users:(("cupsd",pid=899,fd=7))
tcp    LISTEN     0      128    0.0.0.0:80                      0.0.0.0:*      users:(("nginx",pid=1234,fd=6))
tcp    LISTEN     0      128    [::]:22                         [::]:*         users:(("sshd",pid=908,fd=4))
tcp    LISTEN     0      128    [::1]:631                       [::]:*         users:(("cupsd",pid=899,fd=8))
```

*   **`Netid`**: 协议类型 (tcp, udp)
*   **`State`**: 套接字状态 (LISTEN, ESTAB等)。`LISTEN` 表示正在等待连接。
*   **`Recv-Q` / `Send-Q`**: 接收队列/发送队列的字节数。
*   **`Local Address:Port`**: 本地 IP 地址和端口号。
    *   `0.0.0.0` 表示监听所有 IPv4 地址。
    *   `[::]` 表示监听所有 IPv6 地址。
    *   `127.0.0.1` 或 `[::1]` 表示仅监听本地回环地址（localhost）。
*   **`Peer Address:Port`**: 远程 IP 地址和端口号（对于监听端口，通常是 `0.0.0.0:*` 或 `[::]:*`）。
*   **`users:(("program_name",pid=PID,fd=FD))`**: 占用该端口的进程名、PID 和文件描述符。需要 `sudo` 权限才能看到。

**查看特定端口：**

如果你想知道某个特定端口（例如 80 端口）是否被占用，以及被哪个进程占用：

```bash
sudo ss -tulnp | grep ":80"
```

或者更精确地匹配本地端口：

```bash
sudo ss -tulnp sport = :80
```

### 2. 使用 `netstat` 命令 (传统命令)

`netstat` 命令也是一个非常常用（但可能在一些新系统中默认不安装或被弃用）的工具，用于显示网络连接、路由表、接口统计信息等。

**常用选项：**

*   `-t`: 显示 TCP 连接
*   `-u`: 显示 UDP 连接
*   `-l`: 仅显示正在监听的套接字（Listen）
*   `-n`: 不解析服务名，直接显示端口号（numeric）
*   `-p`: 显示占用套接字的进程名和 PID
*   `-a`: 显示所有连接和监听端口
*   `-r`: 显示路由表
*   `-s`: 显示网络统计信息

**查看所有正在监听的 TCP 和 UDP 端口及其进程信息：**

```bash
sudo netstat -tulnp
```

**输出示例解释（与 `ss` 类似）：**

```
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      908/sshd
tcp        0      0 127.0.0.1:631           0.0.0.0:*               LISTEN      899/cupsd
tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      1234/nginx
tcp6       0      0 :::22                   :::*                    LISTEN      908/sshd
tcp6       0      0 ::1:631                 :::*                    LISTEN      899/cupsd
udp        0      0 0.0.0.0:68              0.0.0.0:*                           762/dhclient
```

*   **`Proto`**: 协议类型 (tcp, udp, tcp6, udp6)
*   **`Local Address`**: 本地 IP 地址和端口号。
*   **`Foreign Address`**: 远程 IP 地址和端口号。
*   **`State`**: 连接状态 (`LISTEN` 表示正在监听)。
*   **`PID/Program name`**: 占用该端口的进程 ID 和进程名。需要 `sudo` 权限才能看到。

**查看特定端口：**

```bash
sudo netstat -tulnp | grep ":80"
```

### 3. 使用 `lsof` 命令

`lsof` (list open files) 命令是一个非常强大的工具，它可以列出所有打开的文件，包括网络文件（套接字）。

**常用选项：**

*   `-i`: 列出所有打开的网络文件。
*   `:port`: 指定端口号。
*   `TCP` / `UDP`: 指定协议类型。

**查看所有监听的 TCP 和 UDP 端口：**

```bash
sudo lsof -i -P -n | grep LISTEN
```

*   `-P`: 不将端口号转换为服务名称。
*   `-n`: 不将 IP 地址转换为主机名。

**查看特定端口（例如 80 端口）：**

```bash
sudo lsof -i :80
```

**查看某个进程打开的所有网络端口（例如 PID 为 1234 的进程）：**

```bash
sudo lsof -p 1234 -i
```

**输出示例：**

```
COMMAND    PID   USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
nginx     1234   root    6u  IPv4  20412      0t0  TCP *:80 (LISTEN)
```

*   **`COMMAND`**: 进程名
*   **`PID`**: 进程 ID
*   **`USER`**: 运行该进程的用户
*   **`NAME`**: 本地地址和端口，以及连接状态。

### 4. 使用 `fuser` 命令

`fuser` 命令可以识别使用指定文件或套接字的进程。

**语法：**

```bash
sudo fuser -n <protocol> <port>/<protocol>
```

或

```bash
sudo fuser -k -n <protocol> <port>  # -k 会尝试杀死进程
```

**示例：**

查看占用 TCP 80 端口的进程 PID：

```bash
sudo fuser -n tcp 80
```

输出：`80/tcp: 1234` (表示 PID 为 1234 的进程占用了 TCP 80 端口)

查看占用 UDP 53 端口的进程 PID：

```bash
sudo fuser -n udp 53
```

### 总结

*   **推荐日常使用：** `sudo ss -tulnp` 或 `sudo netstat -tulnp`。它们直接、清晰地显示所有监听端口和对应的进程信息。
*   **查找特定端口：** `sudo ss -tulnp | grep ":80"` 或 `sudo lsof -i :80`。
*   **功能最强大、最灵活：** `lsof`。它可以做更多的事情，不仅仅是查找端口。

根据你的需求和系统环境选择最合适的命令。大多数情况下，`ss` 会是你的首选。